# Define loop variables
variable i loop 10                # Looping 10 times
variable seed index 5 10 9 1 2 77 54 79 67 17  # Define a set of seeds for randomness
variable T equal 300              # Set temperature (300 K)

# Initial system setup
units           metal              # Use metal units for simulation
atom_style      atomic             # Use atomic atom style
boundary        p p p              # Periodic boundary conditions in all directions

# Initial structure setup
lattice bcc 2.8552                 # BCC lattice with lattice constant 2.8552
region box block 0 30 0 30 0 30 units lattice  # Define simulation box (30x30x30 in lattice units)
create_box 1 box                   # Create simulation box with 1 atom type
create_atoms 1 box                 # Create atoms in the box

# Select the central atom for further operations
region rpka sphere 15 15 15 0.2 units lattice  # Define a small spherical region (0.2 lattice units) at the center
group pka region rpka              # Create a group for the central atoms in the region

# Define potential (EAM potential for Fe)
pair_style eam/fs                  # Use EAM/FS potential style
pair_coeff * * ~/Potentials/Fe_mm.eam.fs Fe  # Set potential coefficients for Fe using the specified file

# Define thermodynamic output
thermo 2000                         # Output thermodynamic info every 2000 steps
thermo_style custom step temp etotal time  # Customize thermo output to include step, temp, total energy, and time
dump 1 all custom 500 Fe.${i}.${T}.xyz id type x y z  # Output atomic positions every 500 steps to 'Fe.${i}.${T}.xyz'

# Relaxation under NVT ensemble
velocity all create ${T} ${seed} rot yes dist gaussian  # Create velocities for atoms with Gaussian distribution
fix 1 all nvt temp ${T} ${T} 0.05               # Apply NVT ensemble with constant temperature
timestep 0.001                                 # Set timestep to 0.001
run 15000                                      # Run the simulation for 15000 steps

# Collision simulation under NVE ensemble
unfix 1                                       # Unfix the NVT fix
velocity pka set 300 500 600 units box          # Set velocities of the central atom group with custom values
fix 1 all nve                                 # Apply NVE ensemble for energy conservation
fix 2 all dt/reset 1 0.00000001 0.0005 0.005 units lattice  # Reset timestep parameters for better stability
run 75000                                      # Run the simulation for 75000 steps

# Prepare for the next iteration
clear                                          # Clear the simulation state for the next iteration
next i                                         # Move to the next iteration
next seed                                      # Move to the next seed value
jump in.cas                                    # Jump to the next input file (if used, replace with specific file)
quit                                           # End the simulation
